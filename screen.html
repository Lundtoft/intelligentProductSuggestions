<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <title>Screen</title>
  </head>
  <body>

    <div id="screen">
      <div class="title">
        <h2></h2>
        <span class="type"></span>
      </div>
      <div class="price">
        <h1><span class="digit"></span></h1>
      </div>
      <div class="amount">
        <h2></h2>
      </div>
      <img class="barcode">
        <div class="symbols">
        </div>
    </div>

    <div id="screen-alt" class="hidden">
      <div class="title">
        <h2></h2>
        <span class="type"></span>
      </div>
      <div class="price">
        <h1><span class="digit"></span></h1>
      </div>
      <div class="amount">
        <h2></h2>
      </div>
        <div class="symbols">
        </div>
    </div>

    <script src="jquery.min.js"></script>
    <script src="socket.io.js"></script>
    <script src="JsBarcode.min.js"></script>
    <script type="text/javascript">
      var product = getUrlVars()["product"];
      var pdata;

      var socket = io();

      socket.on(product, function(data){
        JsBarcode(".barcode", pdata.ean, {
            width:3,
            height:50,
            displayValue: true,
            lineColor: "#FFFFFF",
            background: "#000000"
          });
        $('body').css('background', '#000');
        $('body').css('color', '#fff');
        $('.digit').css('background', '#000');
        setTimeout(function(){
          $('body').css('background', '#fff');
          $('body').css('color', '#000');
          $('.digit').css('background', '#fff');
          JsBarcode("#barcode", pdata.ean, {
              width:3,
              height:50,
              displayValue: true,
            });
        }, 5000);

        if(data == 'oko'){

          $('#screen').hide();
          $('#screen-alt').show();

          //$('#background').css('background', '#fff');

          // $('img[src="assets/oko.png"]').animate({
          //   width: 400
          // }, 4000, function(){
          //   $(this).animate({
          //     width: 100
          //   }, 4000, function(){
          //     $('#background').css('background', 'none');
          //   });
          // });



        }

      });

      $.get('/products/'+product, function(data) {
        pdata = data;
        $('.title h2').html(data.name);
        if(data.type == 'slik'){
          data.type = 'Favoritter';
        }
        $('.type').html(data.type);
        $('.amount h2').html(data.volume+' GR');

        price = data.price.toString().split('.');
        if(price.length > 1){
          if(price[1].length < 2){
            price[1] = price[1]+'0';
          }
        }else{
          price[1] = '00';
        }

        $('.price h1').html(price[0]+' s<span class="digit">'+price[1]+'</span>');

        if(data.values){
          for (var i = 0; i < data.values.length; i++) {
            $('.symbols').append('<img src="assets/'+data.values[i]+'.png" alt="" />');
          }
        }

        JsBarcode(".barcode", data.ean, {
            width:3,
            height:50,
            displayValue: true,
            //lineColor: "#FFFFFF",
            //background: "#000000"
          });

          $('.barcode').click(function(){
            parent.history.back();
            return false;
          });

      });

      function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
          vars[key] = value;
        });
        return vars;
      }

    </script>
  </body>
</html>
